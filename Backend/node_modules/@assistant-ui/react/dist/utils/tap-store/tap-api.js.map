{"version":3,"sources":["../../../src/utils/tap-store/tap-api.ts"],"sourcesContent":["import { tapEffect, tapMemo, tapRef } from \"@assistant-ui/tap\";\n\nexport interface ApiObject {\n  [key: string]: ((...args: any[]) => any) | ApiObject;\n}\n\nclass ReadonlyApiHandler<TApi extends ApiObject> implements ProxyHandler<TApi> {\n  constructor(private readonly getApi: () => TApi) {}\n\n  get(_: unknown, prop: string | symbol) {\n    return this.getApi()[prop as keyof TApi];\n  }\n\n  ownKeys(): ArrayLike<string | symbol> {\n    return Object.keys(this.getApi() as object);\n  }\n\n  has(_: unknown, prop: string | symbol) {\n    return prop in (this.getApi() as object);\n  }\n\n  getOwnPropertyDescriptor(_: unknown, prop: string | symbol) {\n    return Object.getOwnPropertyDescriptor(this.getApi(), prop);\n  }\n\n  set() {\n    return false;\n  }\n  defineProperty() {\n    return false;\n  }\n  deleteProperty() {\n    return false;\n  }\n}\n\nexport const tapApi = <TApi extends ApiObject & { getState: () => any }>(\n  api: TApi,\n  options?: {\n    key?: string | undefined;\n  },\n) => {\n  const ref = tapRef(() => api);\n  tapEffect(() => {\n    ref.current = api;\n  });\n\n  const apiProxy = tapMemo(\n    () =>\n      new Proxy<TApi>({} as TApi, new ReadonlyApiHandler(() => ref.current)),\n    [],\n  );\n\n  const key = options?.key;\n  const state = api.getState();\n\n  return tapMemo(\n    () => ({\n      key,\n      state,\n      api: apiProxy,\n    }),\n    [state, key],\n  );\n};\n"],"mappings":";AAAA,SAAS,WAAW,SAAS,cAAc;AAM3C,IAAM,qBAAN,MAA+E;AAAA,EAC7E,YAA6B,QAAoB;AAApB;AAAA,EAAqB;AAAA,EAElD,IAAI,GAAY,MAAuB;AACrC,WAAO,KAAK,OAAO,EAAE,IAAkB;AAAA,EACzC;AAAA,EAEA,UAAsC;AACpC,WAAO,OAAO,KAAK,KAAK,OAAO,CAAW;AAAA,EAC5C;AAAA,EAEA,IAAI,GAAY,MAAuB;AACrC,WAAO,QAAS,KAAK,OAAO;AAAA,EAC9B;AAAA,EAEA,yBAAyB,GAAY,MAAuB;AAC1D,WAAO,OAAO,yBAAyB,KAAK,OAAO,GAAG,IAAI;AAAA,EAC5D;AAAA,EAEA,MAAM;AACJ,WAAO;AAAA,EACT;AAAA,EACA,iBAAiB;AACf,WAAO;AAAA,EACT;AAAA,EACA,iBAAiB;AACf,WAAO;AAAA,EACT;AACF;AAEO,IAAM,SAAS,CACpB,KACA,YAGG;AACH,QAAM,MAAM,OAAO,MAAM,GAAG;AAC5B,YAAU,MAAM;AACd,QAAI,UAAU;AAAA,EAChB,CAAC;AAED,QAAM,WAAW;AAAA,IACf,MACE,IAAI,MAAY,CAAC,GAAW,IAAI,mBAAmB,MAAM,IAAI,OAAO,CAAC;AAAA,IACvE,CAAC;AAAA,EACH;AAEA,QAAM,MAAM,SAAS;AACrB,QAAM,QAAQ,IAAI,SAAS;AAE3B,SAAO;AAAA,IACL,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,KAAK;AAAA,IACP;AAAA,IACA,CAAC,OAAO,GAAG;AAAA,EACb;AACF;","names":[]}