{"version":3,"sources":["../../../../src/legacy-runtime/runtime-cores/assistant-transport/commandQueue.ts"],"sourcesContent":["import { useState, useCallback, useRef, useEffect } from \"react\";\nimport {\n  AssistantTransportCommand,\n  CommandQueueState,\n  QueuedCommand,\n} from \"./types\";\n\nexport const createInitialQueueState = (): CommandQueueState => ({\n  queued: [],\n  inTransit: [],\n});\n\nexport const useCommandQueue = (opts: { onQueue: () => void }) => {\n  const onQueueRef = useRef(opts.onQueue);\n  useEffect(() => {\n    onQueueRef.current = opts.onQueue;\n  });\n\n  const [, rerender] = useState(0);\n  const queueStateRef = useRef<CommandQueueState>(createInitialQueueState());\n\n  const enqueue = (command: AssistantTransportCommand) => {\n    queueStateRef.current = {\n      queued: [...queueStateRef.current.queued, command],\n      inTransit: queueStateRef.current.inTransit,\n    };\n    rerender((prev) => prev + 1);\n\n    onQueueRef.current();\n  };\n\n  const flush = (): QueuedCommand[] => {\n    if (queueStateRef.current.queued.length === 0) return [];\n\n    const queued = queueStateRef.current.queued;\n    queueStateRef.current = {\n      queued: [],\n      inTransit: [...queueStateRef.current.inTransit, ...queued],\n    };\n    rerender((prev) => prev + 1);\n\n    return queued;\n  };\n\n  const markDelivered = () => {\n    queueStateRef.current = { ...queueStateRef.current, inTransit: [] };\n    rerender((prev) => prev + 1);\n  };\n\n  const reset = useCallback(() => {\n    queueStateRef.current = createInitialQueueState();\n    rerender((prev) => prev + 1);\n  }, []);\n\n  return {\n    state: queueStateRef.current,\n    enqueue,\n    flush,\n    markDelivered,\n    reset,\n  };\n};\n"],"mappings":";AAAA,SAAS,UAAU,aAAa,QAAQ,iBAAiB;AAOlD,IAAM,0BAA0B,OAA0B;AAAA,EAC/D,QAAQ,CAAC;AAAA,EACT,WAAW,CAAC;AACd;AAEO,IAAM,kBAAkB,CAAC,SAAkC;AAChE,QAAM,aAAa,OAAO,KAAK,OAAO;AACtC,YAAU,MAAM;AACd,eAAW,UAAU,KAAK;AAAA,EAC5B,CAAC;AAED,QAAM,CAAC,EAAE,QAAQ,IAAI,SAAS,CAAC;AAC/B,QAAM,gBAAgB,OAA0B,wBAAwB,CAAC;AAEzE,QAAM,UAAU,CAAC,YAAuC;AACtD,kBAAc,UAAU;AAAA,MACtB,QAAQ,CAAC,GAAG,cAAc,QAAQ,QAAQ,OAAO;AAAA,MACjD,WAAW,cAAc,QAAQ;AAAA,IACnC;AACA,aAAS,CAAC,SAAS,OAAO,CAAC;AAE3B,eAAW,QAAQ;AAAA,EACrB;AAEA,QAAM,QAAQ,MAAuB;AACnC,QAAI,cAAc,QAAQ,OAAO,WAAW,EAAG,QAAO,CAAC;AAEvD,UAAM,SAAS,cAAc,QAAQ;AACrC,kBAAc,UAAU;AAAA,MACtB,QAAQ,CAAC;AAAA,MACT,WAAW,CAAC,GAAG,cAAc,QAAQ,WAAW,GAAG,MAAM;AAAA,IAC3D;AACA,aAAS,CAAC,SAAS,OAAO,CAAC;AAE3B,WAAO;AAAA,EACT;AAEA,QAAM,gBAAgB,MAAM;AAC1B,kBAAc,UAAU,EAAE,GAAG,cAAc,SAAS,WAAW,CAAC,EAAE;AAClE,aAAS,CAAC,SAAS,OAAO,CAAC;AAAA,EAC7B;AAEA,QAAM,QAAQ,YAAY,MAAM;AAC9B,kBAAc,UAAU,wBAAwB;AAChD,aAAS,CAAC,SAAS,OAAO,CAAC;AAAA,EAC7B,GAAG,CAAC,CAAC;AAEL,SAAO;AAAA,IACL,OAAO,cAAc;AAAA,IACrB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}