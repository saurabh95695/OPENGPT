{"version":3,"sources":["../../src/hooks/tap-resource.ts"],"sourcesContent":["import { ResourceElement } from \"../core/types\";\nimport { tapEffect } from \"./tap-effect\";\nimport {\n  createResourceFiber,\n  unmountResource,\n  renderResource,\n  commitResource,\n} from \"../core/ResourceFiber\";\nimport { tapMemo } from \"./tap-memo\";\nimport { tapState } from \"./tap-state\";\n\nexport function tapResource<R, P>(element: ResourceElement<R, P>): R;\nexport function tapResource<R, P>(\n  element: ResourceElement<R, P>,\n  deps: readonly unknown[],\n): R;\nexport function tapResource<R, P>(\n  element: ResourceElement<R, P>,\n  deps?: readonly unknown[],\n): R {\n  const [stateVersion, rerender] = tapState({});\n  const fiber = tapMemo(\n    () => createResourceFiber(element.type, () => rerender({})),\n    [element.type],\n  );\n\n  const props = deps ? tapMemo(() => element.props, deps) : element.props;\n  const result = tapMemo(\n    () => renderResource(fiber, props),\n    [fiber, props, stateVersion],\n  );\n\n  tapEffect(() => {\n    return () => unmountResource(fiber);\n  }, [fiber]);\n\n  tapEffect(() => {\n    commitResource(fiber, result);\n  }, [fiber, result]);\n\n  return result.state;\n}\n"],"mappings":";AACA,SAAS,iBAAiB;AAC1B;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,eAAe;AACxB,SAAS,gBAAgB;AAOlB,SAAS,YACd,SACA,MACG;AACH,QAAM,CAAC,cAAc,QAAQ,IAAI,SAAS,CAAC,CAAC;AAC5C,QAAM,QAAQ;AAAA,IACZ,MAAM,oBAAoB,QAAQ,MAAM,MAAM,SAAS,CAAC,CAAC,CAAC;AAAA,IAC1D,CAAC,QAAQ,IAAI;AAAA,EACf;AAEA,QAAM,QAAQ,OAAO,QAAQ,MAAM,QAAQ,OAAO,IAAI,IAAI,QAAQ;AAClE,QAAM,SAAS;AAAA,IACb,MAAM,eAAe,OAAO,KAAK;AAAA,IACjC,CAAC,OAAO,OAAO,YAAY;AAAA,EAC7B;AAEA,YAAU,MAAM;AACd,WAAO,MAAM,gBAAgB,KAAK;AAAA,EACpC,GAAG,CAAC,KAAK,CAAC;AAEV,YAAU,MAAM;AACd,mBAAe,OAAO,MAAM;AAAA,EAC9B,GAAG,CAAC,OAAO,MAAM,CAAC;AAElB,SAAO,OAAO;AAChB;","names":[]}