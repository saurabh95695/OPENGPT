{"version":3,"sources":["../../src/core/ResourceFiber.ts"],"sourcesContent":["import { ResourceFn, ResourceFiber, RenderResult } from \"./types\";\nimport { commitRender, cleanupAllEffects } from \"./commit\";\nimport { withResourceFiber } from \"./execution-context\";\n\nexport function createResourceFiber<R, P>(\n  resourceFn: ResourceFn<R, P>,\n  scheduleRerender: () => void,\n): ResourceFiber<R, P> {\n  return {\n    resourceFn,\n    scheduleRerender,\n    cells: [],\n    currentIndex: 0,\n    renderContext: undefined,\n    isFirstRender: true,\n    isMounted: false,\n    isNeverMounted: true,\n  };\n}\n\nexport function unmountResource<R, P>(fiber: ResourceFiber<R, P>): void {\n  // Clean up all effects\n  fiber.isMounted = false;\n  cleanupAllEffects(fiber);\n}\n\nexport function renderResource<R, P>(\n  fiber: ResourceFiber<R, P>,\n  props: P,\n): RenderResult {\n  const result: RenderResult = {\n    commitTasks: [],\n    props,\n    state: undefined,\n  };\n\n  withResourceFiber(fiber, () => {\n    fiber.renderContext = result;\n    try {\n      result.state = fiber.resourceFn(props);\n    } finally {\n      fiber.renderContext = undefined;\n    }\n  });\n\n  return result;\n}\n\nexport function commitResource<R, P>(\n  fiber: ResourceFiber<R, P>,\n  result: RenderResult,\n): void {\n  fiber.isMounted = true;\n  fiber.isNeverMounted = false;\n\n  commitRender(result, fiber);\n}\n"],"mappings":";AACA,SAAS,cAAc,yBAAyB;AAChD,SAAS,yBAAyB;AAE3B,SAAS,oBACd,YACA,kBACqB;AACrB,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,OAAO,CAAC;AAAA,IACR,cAAc;AAAA,IACd,eAAe;AAAA,IACf,eAAe;AAAA,IACf,WAAW;AAAA,IACX,gBAAgB;AAAA,EAClB;AACF;AAEO,SAAS,gBAAsB,OAAkC;AAEtE,QAAM,YAAY;AAClB,oBAAkB,KAAK;AACzB;AAEO,SAAS,eACd,OACA,OACc;AACd,QAAM,SAAuB;AAAA,IAC3B,aAAa,CAAC;AAAA,IACd;AAAA,IACA,OAAO;AAAA,EACT;AAEA,oBAAkB,OAAO,MAAM;AAC7B,UAAM,gBAAgB;AACtB,QAAI;AACF,aAAO,QAAQ,MAAM,WAAW,KAAK;AAAA,IACvC,UAAE;AACA,YAAM,gBAAgB;AAAA,IACxB;AAAA,EACF,CAAC;AAED,SAAO;AACT;AAEO,SAAS,eACd,OACA,QACM;AACN,QAAM,YAAY;AAClB,QAAM,iBAAiB;AAEvB,eAAa,QAAQ,KAAK;AAC5B;","names":[]}